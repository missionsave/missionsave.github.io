<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Precision Architect V5.0 â€“ Fusion Engine</title>
<style>
:root {
  --bg:#0a0a0c; --panel:#16161a; --border:#2d2d33; --text:#ececed;
  --red:#ff4d4d; --green:#00e676; --gold:#ffc107; --blue:#2979ff;
}
body{font-family:'Inter',system-ui,sans-serif;margin:16px;background:var(--bg);color:var(--text);line-height:1.5}
h1{font-size:1.2rem;margin:0 0 1rem;display:flex;justify-content:space-between;align-items:center;letter-spacing:1px}
.grid{display:grid;grid-template-columns:repeat(10,1fr);gap:4px;margin-bottom:1rem}
button.num{padding:12px 0;border:1px solid var(--border);border-radius:4px;cursor:pointer;font-size:1rem;background:#1e1e24;color:#eee;transition:all 0.1s;font-weight:600}
button.num:hover{background:#2d2d38}
button.num:active{transform:scale(0.9)}
button.zero{background:#004d40;border-color:var(--green)}
button.red{color:var(--red)}
.panel{margin-bottom:1rem;padding:16px;border-radius:12px;background:var(--panel);border:1px solid var(--border);box-shadow:0 8px 32px rgba(0,0,0,0.5)}
.label{font-weight:700;color:#71717a;margin-bottom:8px;display:block;text-transform:uppercase;font-size:0.7rem;letter-spacing:1.5px}
.history{font-family:'JetBrains Mono',monospace;font-size:1.1rem;background:#000;padding:12px;border-radius:8px;border:1px solid #222;overflow-x:auto;white-space:nowrap}
.predictions li{margin-bottom:8px;padding:12px;background:#212126;border-radius:8px;display:flex;justify-content:space-between;align-items:center;border-left:4px solid transparent;transition:0.3s}
.predictions li.top-pick{border-left-color:var(--gold);background:linear-gradient(90deg, #2a240d, #212126)}
.pred-num{font-size:1.5rem;font-weight:900;width:50px}
.pred-stats{font-size:0.75rem;color:#a1a1aa;text-align:right;flex:1;margin-right:15px}
.pred-bet{font-size:1.1rem;color:var(--green);font-weight:800;width:80px;text-align:right}
.stats-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:1rem}
.stat-box{background:#1e1e24;padding:12px;border-radius:8px;text-align:center;border:1px solid var(--border)}
.stat-val{font-weight:800;color:#fff;font-size:1.1rem;margin-top:4px;display:block}
.controls{display:flex;gap:8px;margin-top:10px}
input[type=number]{width:80px;padding:8px;border:1px solid #333;border-radius:6px;background:#000;color:var(--gold);font-weight:bold}
button.ctrl{padding:10px;background:#2d2d38;border:none;color:#fff;border-radius:6px;font-weight:600;cursor:pointer;flex:1}
.confidence-meter{height:8px;background:#000;border-radius:4px;margin:12px 0;overflow:hidden;border:1px solid #222}
.confidence-fill{height:100%;background:var(--blue);width:0;transition:width 1s ease-in-out}
.status-pill{padding:6px 14px;border-radius:30px;font-size:0.7rem;font-weight:900;letter-spacing:1px}
.status-wait{background:#271b1b;color:#ef4444;border:1px solid #451a1a}
.status-bet{background:#142914;color:#22c55e;border:1px solid #166534}
.red-txt{color:var(--red)}.black-txt{color:#fff}.green-txt{color:var(--green)}
</style>
</head>
<body>

<h1>
  <span>ARCHITECT V5.0 <small style="font-size:0.6rem;opacity:0.5">FUSION ENGINE</small></span>
  <span id="algo-status" class="status-pill status-wait">ANALYZING</span>
</h1>

<div class="panel">
  <div class="label">Wheel Input</div>
  <div id="buttons-container" class="grid"></div>
  <div class="controls">
    <button id="undo-btn" class="ctrl">Undo</button>
    <button id="clear-btn" class="ctrl">Reset Engine</button>
    <input type="number" id="max-history" value="200" title="Deep Memory Size" />
  </div>
  <div class="history" id="history-display" style="margin-top:12px">...</div>
</div>

<div class="stats-grid">
  <div class="stat-box"><span class="label">Hot Sector</span><span id="stat-sector" class="stat-val">-</span></div>
  <div class="stat-box"><span class="label">Rhythm</span><span id="stat-cycle" class="stat-val">-</span></div>
  <div class="stat-box"><span class="label">Stability</span><span id="stat-backtest" class="stat-val">-</span></div>
</div>

<div class="panel">
  <div style="display:flex;justify-content:space-between;align-items:center">
    <div style="flex:1">
      <span class="label">Bankroll Management</span>
      <input type="number" id="balance-input" value="1000" style="width:100%" />
    </div>
    <div style="flex:1;text-align:right">
      <span class="label">Fusion Confidence</span>
      <div id="confidence-text" style="font-size:1.4rem;font-weight:900;color:var(--blue)">0%</div>
    </div>
  </div>
  <div class="confidence-meter"><div id="confidence-bar" class="confidence-fill"></div></div>
  
  <ul id="predictions" class="predictions" style="margin-top:15px;padding:0;list-style:none"></ul>
</div>

<script>
const ALL = Array.from({length:37}, (_,i)=>i);
const REDS = [1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36];
const WHEEL = [0,32,15,19,4,21,2,25,17,34,6,27,13,36,11,30,8,23,10,5,24,16,33,1,20,14,31,9,22,18,29,7,28,12,35,3,26];
const wheelIdx = {}; WHEEL.forEach((n,i)=>wheelIdx[n]=i);

const SECTORS = { 
  "Voisins": [22,18,29,7,28,12,35,3,26,0,32,15,19,4,21,2,25], 
  "Tiers": [27,13,36,11,30,8,23,10,5,24,16,33], 
  "Orphelins": [1,20,14,31,9,17,34,6] 
};

let history = [];
let currentParams = { window: 35, recency: 4.2, momentum: 1.15, sectorWeight: 8 };

function saveToLocal() {
  localStorage.setItem('roulette_v5_history', JSON.stringify(history));
  localStorage.setItem('roulette_v5_balance', document.getElementById("balance-input").value);
}

function loadFromLocal() {
  const h = localStorage.getItem('roulette_v5_history');
  const b = localStorage.getItem('roulette_v5_balance');
  if (h) history = JSON.parse(h);
  if (b) document.getElementById("balance-input").value = b;
}

function createButtons() {
  const container = document.getElementById("buttons-container");
  container.innerHTML = "";
  for (let n = 0; n <= 36; n++) {
    const btn = document.createElement("button");
    btn.textContent = n;
    btn.className = "num" + (n===0 ? " zero" : REDS.includes(n) ? " red" : "");
    btn.onclick = () => { history.push(n); if(history.length > 250) history.shift(); saveToLocal(); updateView(); };
    container.appendChild(btn);
  }
}

document.getElementById("undo-btn").onclick = () => { history.pop(); saveToLocal(); updateView(); };
document.getElementById("clear-btn").onclick = () => { if(confirm("Clear engine?")) { history = []; saveToLocal(); updateView(); } };

// --- V5 CORE ENGINE ---
function analyze() {
  if (history.length < 5) return null;

  const win = history.slice(-currentParams.window);
  const scores = new Array(37).fill(0);
  const lastNum = history[history.length-1];

  // 1. Hot Frequency & Recency
  win.forEach((n, i) => {
    let weight = (i / win.length) * currentParams.recency;
    scores[n] += (1 + weight);
  });

  // 2. Sector Stability (Which slice of the wheel is active?)
  let sectorHits = { Voisins: 0, Tiers: 0, Orphelins: 0 };
  win.slice(-15).forEach(n => {
    for (let s in SECTORS) if (SECTORS[s].includes(n)) sectorHits[s]++;
  });
  let activeSector = Object.keys(sectorHits).reduce((a, b) => sectorHits[a] > sectorHits[b] ? a : b);

  // 3. Dealer Rhythm (Jump Logic)
  let jumps = [];
  for(let i=1; i < win.length; i++) {
    let d = wheelIdx[win[i]] - wheelIdx[win[i-1]];
    jumps.push(d < 0 ? d + 37 : d);
  }
  let avgJump = jumps.slice(-10).reduce((a,b)=>a+b,0) / 10;
  
  // Calculate Dispersion (Stability)
  let variance = jumps.slice(-10).reduce((a,b) => a + Math.pow(b - avgJump, 2), 0) / 10;
  let stability = Math.max(0, 100 - (variance * 2.5));

  // 4. Final Convergence Scoring
  ALL.forEach(n => {
    // Sector Bonus
    if (SECTORS[activeSector].includes(n)) scores[n] += currentParams.sectorWeight;
    
    // Rhythm alignment
    let expectedIdx = (wheelIdx[lastNum] + Math.round(avgJump)) % 37;
    let distToJump = Math.min(Math.abs(wheelIdx[n] - expectedIdx), 37 - Math.abs(wheelIdx[n] - expectedIdx));
    if (distToJump <= 1) scores[n] += (stability / 10);

    // Physical Position Decay (From User Request)
    if (wheelIdx[n] === wheelIdx[lastNum]) scores[n] *= 0.4;
  });

  const ranked = ALL.map(n => ({ n, s: scores[n] })).sort((a,b) => b.s - a.s);
  
  // Robust Confidence calculation
  let topFiveAvg = ranked.slice(0,5).reduce((a,b)=>a+b.s, 0) / 5;
  let totalAvg = ranked.reduce((a,b)=>a+b.s, 0) / 37;
  let confidence = Math.min(99, ((topFiveAvg / totalAvg) - 1.2) * 45);
  if (stability < 30) confidence *= 0.5; // Massive penalty for chaotic dealer

  return { ranked, confidence, activeSector, stability, avgJump };
}

function updateView() {
  const display = document.getElementById("history-display");
  const list = document.getElementById("predictions");
  const count = document.getElementById("count-badge");
  
  if (history.length === 0) { display.innerHTML = "..."; list.innerHTML = ""; return; }
  
  display.innerHTML = history.slice().reverse().map(n => 
    `<span class="${n===0?'green-txt':REDS.includes(n)?'red-txt':'black-txt'}">${n}</span>`
  ).join(" ");

  const data = analyze();
  if (!data) return;

  const bar = document.getElementById("confidence-bar");
  const text = document.getElementById("confidence-text");
  const status = document.getElementById("algo-status");

  bar.style.width = data.confidence + "%";
  text.textContent = Math.round(data.confidence) + "%";
  
  if (data.confidence > 55) {
    status.className = "status-pill status-bet";
    status.textContent = "STRIKE ZONE";
    bar.style.background = "var(--green)";
  } else {
    status.className = "status-pill status-wait";
    status.textContent = "OBSERVING";
    bar.style.background = "var(--blue)";
  }

  document.getElementById("stat-sector").textContent = data.activeSector;
  document.getElementById("stat-cycle").textContent = data.avgJump.toFixed(1);
  document.getElementById("stat-backtest").textContent = Math.round(data.stability) + "%";

  list.innerHTML = "";
  const bankroll = parseFloat(document.getElementById("balance-input").value) || 1000;
  
  data.ranked.slice(0,7).forEach((item, i) => {
    const li = document.createElement("li");
    if (i === 0) li.className = "top-pick";
    
    // Proportional betting: Only bet heavy when confidence is high
    let unit = (bankroll * 0.005) * (data.confidence / 50);
    let bet = Math.max(0, unit * (1 - i*0.15)).toFixed(1);

    li.innerHTML = `
      <div class="pred-num ${item.n===0?'green-txt':REDS.includes(item.n)?'red-txt':'black-txt'}">${item.n}</div>
      <div class="pred-stats">Sector: ${Object.keys(SECTORS).find(k=>SECTORS[k].includes(item.n)) || 'Misc'}<br>Weight: ${item.s.toFixed(1)}</div>
      <div class="pred-bet">$${bet}</div>
    `;
    list.appendChild(li);
  });
}

createButtons();
loadFromLocal();
updateView();
</script>
</body>
</html>