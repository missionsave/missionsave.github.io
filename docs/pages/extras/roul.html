<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Roulette Trend Command</title>
    <style>
        :root { --bg: #0f1012; --panel: #1a1b1e; --border: #2a2b2e; --accent: #00d2a0; --red: #e74c3c; --text: #ecf0f1; }
        body { font-family: 'Segoe UI', Roboto, Helvetica, sans-serif; background: var(--bg); color: var(--text); display: flex; flex-direction: column; align-items: center; padding: 0; margin: 0; height: 100vh; overflow: hidden; }
        
        /* --- TOP DASHBOARD --- */
        .dashboard { width: 100%; background: var(--panel); border-bottom: 1px solid var(--border); padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 10px rgba(0,0,0,0.3); z-index: 10; }
        .pred-box { display: flex; align-items: center; gap: 10px; }
        .pred-label { font-size: 11px; text-transform: uppercase; color: #888; letter-spacing: 1px; font-weight: bold; }
        .pred-number { background: var(--accent); color: #000; font-weight: 800; font-size: 18px; width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; border-radius: 50%; box-shadow: 0 0 10px rgba(0, 210, 160, 0.4); }
        .pred-number.red { background: var(--red); color: white; box-shadow: 0 0 10px rgba(231, 76, 60, 0.4); }
        .pred-number.zero { background: #27ae60; color: white; }
        
        .stat-group { display: flex; gap: 20px; font-size: 12px; color: #aaa; }
        .stat-val { color: white; font-weight: bold; font-family: monospace; font-size: 14px; }
        
        .settings-btn { background: #333; border: 1px solid #555; color: #ccc; padding: 5px 12px; border-radius: 4px; cursor: pointer; font-size: 11px; text-transform: uppercase; transition: 0.2s; }
        .settings-btn:hover { background: #444; color: white; }

        /* --- SETTINGS MODAL (Overlay) --- */
        .settings-overlay { display: none; position: absolute; top: 60px; right: 20px; width: 300px; background: #222; border: 1px solid #444; border-radius: 8px; padding: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.8); z-index: 20; }
        .opt-btn { width: 100%; padding: 10px; background: linear-gradient(135deg, #2980b9, #2c3e50); border: none; color: white; font-weight: bold; cursor: pointer; margin-top: 10px; border-radius: 4px; }
        .opt-btn:hover { opacity: 0.9; }
        .row { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 12px; align-items: center; }
        input { background: #111; border: 1px solid #444; color: white; width: 50px; padding: 4px; text-align: center; }

        /* --- MAIN LAYOUT --- */
        .layout { display: flex; width: 100%; height: calc(100vh - 70px); }
        
        /* LEFT: INPUT GRID */
        .input-panel { flex: 0 0 320px; padding: 10px; border-right: 1px solid var(--border); overflow-y: auto; background: #141518; }
        .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px; }
        button.num-btn { padding: 15px; font-size: 16px; font-weight: bold; border: none; border-radius: 4px; cursor: pointer; transition: transform 0.1s; background: #2d3436; color: #b2bec3; }
        button.num-btn:active { transform: scale(0.95); }
        button.num-btn[data-c="red"] { background: #c0392b; color: white; }
        button.num-btn[data-c="black"] { background: #2d3436; color: white; border: 1px solid #444; }
        button.num-btn[data-c="green"] { background: #27ae60; color: white; grid-column: span 3; }
        
        /* RIGHT: DATA TABLE */
        .data-panel { flex: 1; display: flex; flex-direction: column; background: var(--bg); }
        .table-container { flex: 1; overflow-y: auto; position: relative; }
        
        table { width: 100%; border-collapse: collapse; font-size: 13px; text-align: center; }
        th { position: sticky; top: 0; background: #222; color: #888; padding: 10px; font-weight: 600; font-size: 11px; text-transform: uppercase; border-bottom: 2px solid #333; z-index: 2; }
        td { padding: 8px; border-bottom: 1px solid #222; color: #777; }
        
        /* Dynamic Row Styling */
        .row-trend { background: rgba(0, 210, 160, 0.08); }
        .row-trend td:first-child { border-left: 4px solid var(--accent); color: var(--accent); font-weight: bold; }
        .hit-high { color: var(--accent); font-weight: bold; text-shadow: 0 0 5px rgba(0,210,160,0.3); }
        .hit-mid { color: #f1c40f; }
        .hit-low { color: #444; }
        
        /* Footer Controls */
        .controls { padding: 10px; border-top: 1px solid var(--border); display: flex; gap: 10px; justify-content: center; background: var(--panel); }
        .ctrl-btn { background: #333; color: #ccc; border: none; padding: 8px 20px; border-radius: 4px; cursor: pointer; font-size: 12px; }
        .ctrl-btn:hover { background: #444; color: white; }

        /* Responsive Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #111; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }
    </style>
</head>
<body>

    <div class="dashboard">
        <div class="pred-box">
            <span class="pred-label">Target<br>Numbers</span>
            <div id="predictionDisplay" style="display:flex; gap:8px;">
                <div style="color:#444; font-size:12px;">Waiting for data...</div>
            </div>
        </div>

        <div class="stat-group">
            <div>Window: <span id="winVal" class="stat-val">0</span></div>
            <div>Range: <span id="rangeVal" class="stat-val">14</span></div>
            <div>Sum: <span id="sumVal" class="stat-val">3</span></div>
        </div>

        <button class="settings-btn" onclick="toggleSettings()">âš™ Params</button>
    </div>

    <div id="settingsPanel" class="settings-overlay">
        <h4 style="margin:0 0 10px 0; color:#fff;">Tuner</h4>
        <div class="row"><label>Pos Range (1-X)</label><input type="number" id="inpRange" value="14"></div>
        <div class="row"><label>Total Hits (Sum)</label><input type="number" id="inpHits" value="3"></div>
        <div class="row"><label>Top Leaders</label><input type="number" id="inpLead" value="4"></div>
        <button class="opt-btn" onclick="applySettings()">Apply Manual</button>
        <hr style="border-color:#333; opacity:0.3; margin:15px 0;">
        <button class="opt-btn" style="background: linear-gradient(135deg, #8e44ad, #c0392b);" onclick="runSimulation()">
            ðŸŽ² Run 1000 Spin Sim
        </button>
        <div id="simResult" style="font-size:11px; color:#aaa; margin-top:8px; text-align:center;"></div>
    </div>

    <div class="layout">
        <div class="input-panel">
            <div class="grid" id="inputGrid"></div>
        </div>

        <div class="data-panel">
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th style="width:15%">Pos</th>
                            <th style="width:20%">Num</th>
                            <th style="width:30%">Window Hits</th>
                            <th style="width:35%">Last Interval</th>
                        </tr>
                    </thead>
                    <tbody id="mainTableBody"></tbody>
                </table>
            </div>
            
            <div class="controls">
                <button class="ctrl-btn" onclick="undo()">Undo Last</button>
                <button class="ctrl-btn" style="background:#522;" onclick="clearData()">Reset History</button>
            </div>
        </div>
    </div>

<script>
    /* --- CONFIG & STATE --- */
    // const STORAGE_KEY = 'roulette_pro_v3';
	const STORAGE_KEY = 'roulette_opt_v2';
    const REDS = [1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36];
    
    let history = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
    let params = { range: 14, hits: 3, leaders: 4 };

    /* --- INITIALIZATION --- */
    function init() {
        const grid = document.getElementById('inputGrid');
        // Standard Euro Layout order (optional, using 0-36 numeric for simplicity)
        // 0 first
        addBtn(grid, 0);
        for(let i=1; i<=36; i++) addBtn(grid, i);
        
        render();
    }

    function addBtn(container, num) {
        let color = num === 0 ? 'green' : (REDS.includes(num) ? 'red' : 'black');
        let btn = document.createElement('button');
        btn.className = 'num-btn';
        btn.textContent = num;
        btn.dataset.c = color;
        btn.onclick = () => { history.unshift(num); save(); render(); };
        container.appendChild(btn);
    }

    /* --- CORE ANALYZER --- */
    function analyze(data, pRange, pHits) {
        if(data.length < 5) return { bestWin: 0, scores: {} };

        let bestWin = 5;
        let finalScores = {};

        // Find adaptive window size
        for (let w = 5; w <= data.length; w++) {
            let tempScores = {};
            const sub = data.slice(0, w);
            
            sub.forEach((n, i) => {
                const interval = data.slice(i + 1).indexOf(n) + 1;
                if (interval > 0) tempScores[interval] = (tempScores[interval] || 0) + 1;
            });

            // Count sum of hits in Range (1 to pRange)
            let sum = 0;
            for(let p=1; p<=pRange; p++) sum += (tempScores[p] || 0);

            if (sum >= pHits || w === data.length) {
                bestWin = w;
                finalScores = tempScores;
                break;
            }
        }
        return { bestWin, scores: finalScores };
    }

    /* --- SIMULATION ENGINE (1000 SPINS) --- */
    function runSimulation() {
        if(!confirm("Backtest 1000 spins to find best params? Real history will be preserved.")) return;

        // 1. Generate Ghost History
        let ghostHistory = [];
        for(let i=0; i<1000; i++) ghostHistory.unshift(Math.floor(Math.random() * 37));

        // 2. Define Bots
        const bots = [
            { name: "Aggr (R10/H3)", r: 10, h: 3, l: 4, wins: 0 },
            { name: "Bal (R14/H3)",  r: 14, h: 3, l: 5, wins: 0 },
            { name: "Wide (R18/H4)", r: 18, h: 4, l: 6, wins: 0 },
            { name: "Safe (R20/H5)", r: 20, h: 5, l: 5, wins: 0 }
        ];

        // 3. Fast Forward Simulation
        // We test the last 500 spins of the ghost history to simulate 'live' play
        const testRange = 500;
        let simSlice = ghostHistory.slice(testRange).reverse(); // Start with older data

        for(let i = testRange - 1; i >= 0; i--) {
            const result = ghostHistory[i];
            
            bots.forEach(bot => {
                const ana = analyze(simSlice.slice().reverse(), bot.r, bot.h);
                // Get Predictions
                let ranks = [];
                for(let p=1; p<=bot.r; p++) ranks.push({p:p, h:ana.scores[p]||0});
                
                const leaders = ranks.sort((a,b)=>b.h-a.h).slice(0, bot.l).map(x=>x.p);
                // Map Pos to Number (Pos 1 is index 0 of simSlice reversed, i.e., last item)
                // simSlice is [oldest ... newest]. Pos 1 is newest.
                const predNums = leaders.map(pos => simSlice[simSlice.length - pos]);

                if(predNums.includes(result)) bot.wins++;
            });
            simSlice.push(result);
        }

        // 4. Winner Winner
        bots.sort((a,b) => b.wins - a.wins);
        const best = bots[0];

        // 5. Apply to UI
        document.getElementById('inpRange').value = best.r;
        document.getElementById('inpHits').value = best.h;
        document.getElementById('inpLead').value = best.l;
        applySettings();

        document.getElementById('simResult').innerHTML = 
            `<span style="color:#0f9">Winner: ${best.name}</span> (${best.wins} hits/500)`;
    }

    /* --- RENDERING --- */
    function render() {
        const tbody = document.getElementById('mainTableBody');
        tbody.innerHTML = '';
        
        // 1. Get Analysis
        const { bestWin, scores } = analyze(history, params.range, params.hits);
        
        // Update Dashboard Stats
        document.getElementById('winVal').textContent = bestWin;
        document.getElementById('rangeVal').textContent = params.range;
        document.getElementById('sumVal').textContent = params.hits;

        // 2. Identify Leaders (Positions)
        let rankData = [];
        for(let p=1; p<=params.range; p++) rankData.push({ p: p, h: scores[p]||0 });
        
        // Filter leaders (must have > 0 hits)
        const leaders = rankData
            .sort((a,b) => b.h - a.h)
            .slice(0, params.leaders)
            .filter(x => x.h > 0)
            .map(x => x.p);

        // 3. Update Prediction Display (Top Badge Bar)
        const predContainer = document.getElementById('predictionDisplay');
        predContainer.innerHTML = '';
        if(leaders.length === 0) {
            predContainer.innerHTML = '<div style="color:#666; font-style:italic; padding-top:8px;">No trend detected yet</div>';
        } else {
            leaders.forEach(pos => {
                const num = history[pos-1]; // Pos 1 is index 0
                if(num !== undefined) {
                    const colorClass = num === 0 ? 'zero' : (REDS.includes(num) ? 'red' : '');
                    predContainer.innerHTML += `<div class="pred-number ${colorClass}">${num}</div>`;
                }
            });
        }

        // 4. Render Merged Table
        // We only render as many rows as the Range (e.g., 14 rows), because 'Rank is Pos'
        // Actually, user said "Keep real history". So we render the whole history.
        // But we add the "Hits" column which corresponds to the Position of that row.
        
        history.forEach((num, i) => {
            const pos = i + 1;
            const interval = history.slice(i + 1).indexOf(num) + 1;
            
            // "Zone Hits": How many hits does THIS Position (e.g. Pos 5) currently have?
            const hits = scores[pos] || 0;
            const isLeader = leaders.includes(pos);
            
            // Hit coloring
            let hitClass = 'hit-low';
            if(hits > 0) hitClass = 'hit-mid';
            if(hits >= 2) hitClass = 'hit-high';
            if(hits === 0 && pos <= params.range) hitClass = 'hit-low'; 
            
            // Row HTML
            const numColor = num === 0 ? '#27ae60' : (REDS.includes(num) ? '#e74c3c' : '#bdc3c7');
            
            const rowClass = isLeader ? 'row-trend' : '';
            
            // Only show hits if it's within the analyzed window/range roughly
            const hitDisplay = (pos <= 50) ? hits : '-'; 

            tbody.insertAdjacentHTML('beforeend', `
                <tr class="${rowClass}">
                    <td>${pos}</td>
                    <td style="color:${numColor}; font-weight:bold;">${num}</td>
                    <td class="${hitClass}">${hitDisplay}</td>
                    <td style="color:#555;">${interval > 0 ? interval : '-'}</td>
                </tr>
            `);
        });
    }

    /* --- UTILS --- */
    function toggleSettings() {
        const el = document.getElementById('settingsPanel');
        el.style.display = el.style.display === 'block' ? 'none' : 'block';
    }

    function applySettings() {
        params.range = parseInt(document.getElementById('inpRange').value);
        params.hits = parseInt(document.getElementById('inpHits').value);
        params.leaders = parseInt(document.getElementById('inpLead').value);
        render();
        toggleSettings();
    }

    function save() { localStorage.setItem(STORAGE_KEY, JSON.stringify(history)); }
    function undo() { history.shift(); save(); render(); }
    function clearData() { if(confirm("Reset History?")) { history = []; save(); render(); } }

    init();
</script>
</body>
</html>