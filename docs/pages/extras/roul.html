<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Windowed Roulette Optimizer</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: system-ui, -apple-system, sans-serif;
      background: #0f0f0f;
      color: #e0e0e0;
      margin: 0;
      padding: 10px;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }
    .panel {
      background: #1a1a1a;
      border: 1px solid #333;
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 8px;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(10, 1fr);
      gap: 5px;
      margin-bottom: 10px;
    }
    button.num {
      padding: 10px;
      background: #252525;
      color: #eee;
      border: 1px solid #333;
      border-radius: 4px;
      font-weight: bold;
      cursor: pointer;
    }
    button.num:hover { background: #333; }
    button.zero { background: #0a5c0a; }
    button.red { color: #ff5252; }
    
    .controls {
      display: flex;
      gap: 8px;
      margin-bottom: 8px;
      flex-wrap: wrap;
    }
    button.ctrl {
      flex: 1;
      padding: 8px;
      background: #333;
      color: #bbb;
      border: 1px solid #444;
      border-radius: 4px;
      cursor: pointer;
      min-width: 80px;
    }
    button.ctrl:hover { background: #444; color: #fff; }
    button.action { background: #1b4d1b; color: white; border-color: #2e7d32; }
    button.action:hover { background: #2e7d32; }

    .inputs-row {
      display: flex;
      gap: 15px;
      align-items: center;
      margin-bottom: 10px;
      background: #111;
      padding: 8px;
      border-radius: 4px;
      border: 1px solid #222;
    }
    .inputs-row label { color: #888; font-size: 0.85rem; margin-right: 5px; }
    input[type="number"] {
      background: #222;
      border: 1px solid #444;
      color: #fff;
      padding: 4px;
      width: 70px;
      border-radius: 3px;
    }

    .history-box {
      background: #000;
      border: 1px solid #222;
      padding: 8px;
      font-family: monospace;
      white-space: nowrap;
      overflow-x: auto;
      margin-bottom: 8px;
      height: 40px;
      display: flex;
      align-items: center;
    }
    
    .matrix-wrapper {
      flex-grow: 1;
      overflow: auto;
      border: 1px solid #333;
      background: #141414;
      position: relative;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.8rem;
    }
    th, td {
      border: 1px solid #222;
      padding: 6px;
      text-align: center;
    }
    th {
      background: #222;
      color: #aaa;
      position: sticky;
      top: 0;
      z-index: 2;
    }
    
    .hot-pick {
      background: #1b4d1b;
      color: #fff !important;
      font-weight: bold;
      border: 1px solid #2e7d32;
    }
    .red-txt { color: #ff5252; }
    .green-txt { color: #4caf50; }
    .black-txt { color: #aaa; }
    
    #optimizer-status {
      margin-top: 5px;
      color: #ffeb3b;
      font-size: 0.9rem;
      font-weight: bold;
    }
    .stat-val { color: #4fc3f7; font-weight: bold; }
  </style>
</head>

<body>

<div class="panel">
  <div class="grid" id="buttons-grid"></div>

  <div class="controls">
    <button class="ctrl" id="undo-btn">Undo</button>
    <button class="ctrl" id="reset-btn">Reset</button>
    <button class="ctrl" id="save-btn">Save</button>
    <button class="ctrl" id="load-btn">Load</button>
  </div>

  <div class="history-box" id="history-display"></div>

  <div class="inputs-row">
    <div>
      <label>Top N:</label>
      <input id="topqt-input" type="number" value="6" min="1" max="36" />
    </div>
    <div>
      <label>Window:</label>
      <input id="window-input" type="number" value="50" min="1" />
    </div>
    <div>
      <label>Current Seed:</label>
      <input id="seed-input" type="number" value="99999" />
      <button class="ctrl" style="padding:4px 8px;" id="apply-seed-btn">Set</button>
    </div>
  </div>
  
  <div id="stats-display" style="font-size: 0.8rem; color:#888;">
    Current Prediction: <span id="trend-data" class="stat-val">...</span>
  </div>
</div>

<div class="matrix-wrapper">
  <table>
    <thead>
      <tr>
        <th>Position</th>
        <th>Number</th>
        <th>Status</th>
        <th>Window Hits</th>
      </tr>
    </thead>
    <tbody id="table-body"></tbody>
  </table>
</div>

<div class="panel" style="margin-top: 8px;">
  <div class="inputs-row" style="margin:0; background:transparent; border:none; padding:0;">
    <label>Start Seed:</label>
    <input id="seed-start" type="number" value="1" />
    <label>End Seed:</label>
    <input id="seed-end" type="number" value="1000" />
    <button class="ctrl action" id="optimize-btn">Find Max Wins</button>
  </div>
  <div id="optimizer-status">Ready to optimize.</div>
</div>

<script>
/* ============================
   STATE
============================ */

let TOPQT = 6;
let SEED = 99999;
let WINDOW_SIZE = 50;
let history = [];

const LS_KEY = "roulette_window_v2";
const REDS = [1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36];

/* ============================
   LOCAL STORAGE
============================ */

function saveState() {
  localStorage.setItem(LS_KEY, JSON.stringify({ history, SEED, TOPQT, WINDOW_SIZE }));
}

function loadState() {
  const raw = localStorage.getItem(LS_KEY);
  if (!raw) return;
  try {
    const data = JSON.parse(raw);
    if (Array.isArray(data.history)) history = data.history;
    if (typeof data.SEED === "number") SEED = data.SEED;
    if (typeof data.TOPQT === "number") TOPQT = data.TOPQT;
    if (typeof data.WINDOW_SIZE === "number") WINDOW_SIZE = data.WINDOW_SIZE;

    document.getElementById("seed-input").value = SEED;
    document.getElementById("topqt-input").value = TOPQT;
    document.getElementById("window-input").value = WINDOW_SIZE;
  } catch {}
}

/* ============================
   PURE RANDOM (Mulberry32)
   Consistent & Simplified
============================ */

function mulberry32(seed) {
  return function() {
    let t = seed += 0x6D2B79F5;
    t = Math.imul(t ^ t >>> 15, t | 1);
    t ^= t + Math.imul(t ^ t >>> 7, t | 61);
    return ((t ^ t >>> 14) >>> 0) / 4294967296;
  };
}

// Fisher-Yates shuffle using the seeded generator
function shuffleWithSeed(seed) {
  const arr = [...Array(37).keys()]; // 0 to 36
  const rng = mulberry32(seed);
  
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(rng() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

// Get the Top N numbers purely from the seed shuffle
// No complex scoring or trend analysis (simplified)
function getTopN(seed, topqt) {
  const wheel = shuffleWithSeed(seed); 
  return wheel.slice(0, topqt);
}

/* ============================
   OPTIMIZER (Windowed Max Wins)
============================ */

function optimizeSeed() {
  const start = parseInt(document.getElementById("seed-start").value, 10);
  const end = parseInt(document.getElementById("seed-end").value, 10);
  const status = document.getElementById("optimizer-status");
  
  // Refresh standard inputs
  applyInputs();

  if (history.length === 0) {
    status.textContent = "No history available to check wins.";
    return;
  }

  // Get the relevant slice of history (The Window)
  const startIndex = Math.max(0, history.length - WINDOW_SIZE);
  const relevantHistory = history.slice(startIndex);

  let bestSeed = null;
  let maxWins = -1;
  let bestPicks = [];

  // Iterate through seeds
  for (let s = start; s <= end; s++) {
    const picks = getTopN(s, TOPQT);
    let wins = 0;

    // Count wins in the window
    for (const spin of relevantHistory) {
      if (picks.includes(spin)) {
        wins++;
      }
    }

    if (wins > maxWins) {
      maxWins = wins;
      bestSeed = s;
      bestPicks = picks;
    }
  }

  // Update State
  if (bestSeed !== null) {
    SEED = bestSeed;
    document.getElementById("seed-input").value = SEED;
    status.innerHTML = `Found Seed <span class="stat-val">${bestSeed}</span> with <span class="stat-val">${maxWins}</span> wins in last ${relevantHistory.length} spins.`;
    saveState();
    renderAll();
  } else {
    status.textContent = "Optimization failed.";
  }
}

/* ============================
   UI RENDERING
============================ */

function renderHistory() {
  const el = document.getElementById("history-display");
  el.innerHTML = history
    .map(n => `<span class="${n===0?'green-txt':REDS.includes(n)?'red-txt':'black-txt'}">${n}</span>`)
    .join(" ");
  el.scrollLeft = el.scrollWidth;
}

function renderTrend() {
  const picks = getTopN(SEED, TOPQT);
  document.getElementById("trend-data").textContent = `[ ${picks.join(", ")} ]`;
}

function renderTable() {
  const wheel = shuffleWithSeed(SEED); // Get full order for this seed
  const picks = wheel.slice(0, TOPQT); // The top predictions
  
  // Prepare Window Data for Hit Count Column
  const startIndex = Math.max(0, history.length - WINDOW_SIZE);
  const relevantHistory = history.slice(startIndex);

  const tbody = document.getElementById("table-body");
  tbody.innerHTML = "";

  // We display the seed's generated order
  for (let i = 0; i < 37; i++) {
    const num = wheel[i];
    const isHot = i < TOPQT; // It's hot if it's in the top N of the shuffle
    
    // Calculate hits in window for this specific number
    const hitsInWindow = relevantHistory.filter(h => h === num).length;

    const colorClass = num===0 ? "green-txt" : REDS.includes(num) ? "red-txt" : "black-txt";
    const bgClass = isHot ? "hot-pick" : "";
    const fire = isHot ? "ðŸ”¥" : "";

    tbody.insertAdjacentHTML("beforeend", `
      <tr>
        <td>${i+1}</td>
        <td class="${colorClass} ${bgClass}" style="font-size:1.1em;">${num} ${fire}</td>
        <td>${isHot ? "PREDICTED" : "-"}</td>
        <td>${hitsInWindow}</td>
      </tr>
    `);
  }
}

function renderAll() {
  renderHistory();
  renderTrend();
  renderTable();
}

/* ============================
   HANDLERS
============================ */

function addNumber(n) {
  history.push(n);
  saveState();
  renderAll();
}

function undoHistory() {
  history.pop();
  saveState();
  renderAll();
}

function resetHistory() {
  if (confirm("Reset all history?")) {
    history = [];
    saveState();
    renderAll();
    document.getElementById("optimizer-status").textContent = "History reset.";
  }
}

function applyInputs() {
  const s = parseInt(document.getElementById("seed-input").value);
  const t = parseInt(document.getElementById("topqt-input").value);
  const w = parseInt(document.getElementById("window-input").value);

  if (!isNaN(s)) SEED = s;
  if (!isNaN(t) && t > 0 && t <= 37) TOPQT = t;
  if (!isNaN(w) && w > 0) WINDOW_SIZE = w;
  
  saveState();
  renderAll();
}

/* ============================
   INIT
============================ */

function setupButtons() {
  const grid = document.getElementById("buttons-grid");
  grid.innerHTML = "";
  for (let n = 0; n < 37; n++) {
    const btn = document.createElement("button");
    btn.textContent = n;
    btn.className = `num ${n===0?'zero':REDS.includes(n)?'red':''}`;
    btn.onclick = () => addNumber(n);
    grid.appendChild(btn);
  }
}

function init() {
  loadState();
  setupButtons();
  renderAll();

  document.getElementById("undo-btn").onclick = undoHistory;
  document.getElementById("reset-btn").onclick = resetHistory;
  document.getElementById("save-btn").onclick = () => { saveState(); alert("Saved"); };
  document.getElementById("load-btn").onclick = () => { loadState(); renderAll(); };
  
  document.getElementById("apply-seed-btn").onclick = applyInputs;
  document.getElementById("topqt-input").onchange = applyInputs;
  document.getElementById("window-input").onchange = applyInputs;
  
  document.getElementById("optimize-btn").onclick = optimizeSeed;
}

init();
</script>

</body>
</html>