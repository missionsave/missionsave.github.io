<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta content="text/html; charset=UTF-8" http-equiv="content-type">
<title>Precision Roulette Architect â€“ Full Edition</title>
<style>
/* FULL STYLE SHEET */
body {
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    margin: 20px;
    background: #121212;
    color: #e0e0e0;
}
h1 {
    font-size: 1.4rem;
    margin-bottom: 0.5rem;
    color: #fff;
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.grid {
    display: grid;
    grid-template-columns: repeat(10, 1fr);
    gap: 6px;
    margin-bottom: 1rem;
}
button.num {
    padding: 10px 0;
    border: 1px solid #333;
    border-radius: 4px;
    cursor: pointer;
    font-size: 0.95rem;
    background: #252525;
    color: #eee;
    transition: all 0.1s;
    font-weight: 500;
}
button.num:hover { background: #444; border-color: #666; }
button.num:active { transform: scale(0.96); }
button.zero { background: #0a5c0a; border-color: #0f7a0f; }
button.red { color: #ff6b6b; }

.panel {
    margin-bottom: 1rem;
    padding: 15px;
    border-radius: 8px;
    background: #1e1e1e;
    border: 1px solid #333;
    box-shadow: 0 4px 6px rgba(0,0,0,0.3);
}
.label {
    font-weight: 600;
    margin-bottom: 8px;
    display: block;
    color: #bbb;
}
.history {
    font-family: 'Courier New', monospace;
    font-size: 0.9rem;
    word-wrap: break-word;
    color: #aaa;
    line-height: 1.4;
    max-height: 60px;
    overflow-y: auto;
}
.predictions li {
    margin-bottom: 6px;
    padding: 8px;
    background: #2a2a2a;
    border-radius: 4px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-left: 3px solid transparent;
}
.predictions li.top-pick {
    border-left: 3px solid #ffd700;
    background: #332b00;
}
.pred-num { font-size: 1.2rem; font-weight: bold; width: 40px; }
.pred-stats { font-size: 0.75rem; color: #888; flex-grow: 1; text-align: right; }
.pred-bet { font-size: 0.9rem; color: #4caf50; margin-left: 10px; font-weight: bold; min-width: 60px; text-align: right; }

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
    gap: 10px;
    font-size: 0.8rem;
    margin-top: 10px;
}
.stat-box {
    background: #252525;
    padding: 8px;
    border-radius: 4px;
    text-align: center;
}
.stat-val { font-weight: bold; color: #fff; display: block; margin-top: 4px; font-size: 1rem;}

.controls {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    align-items: center;
    margin-bottom: 0.8rem;
}
input[type="number"] {
    width: 60px;
    padding: 4px 6px;
    border-radius: 4px;
    border: 1px solid #444;
    background: #111;
    color: #eee;
}
button.ctrl {
    padding: 6px 12px;
    background: #333;
    border: none;
    color: #ccc;
    border-radius: 4px;
    cursor: pointer;
    font-weight: 600;
}
button.ctrl:hover { background: #555; color: #fff; }

.badge {
    display: inline-block;
    padding: 2px 6px;
    border-radius: 4px;
    background: #333;
    font-size: 0.75rem;
    margin-left: 6px;
    color: #888;
}
.red-txt { color: #ff6b6b; }
.black-txt { color: #eee; }
.green-txt { color: #4caf50; }

.balance-section {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
    background: #181818;
    padding: 10px;
    border-radius: 6px;
}
.confidence-meter {
    height: 4px;
    background: #333;
    border-radius: 2px;
    margin-top: 4px;
    width: 100%;
    overflow: hidden;
}
.confidence-fill {
    height: 100%;
    background: #4caf50;
    width: 0%;
    transition: width 0.5s;
}

.status-pill {
    padding: 4px 10px;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: bold;
    text-transform: uppercase;
}
.status-wait { background: #551a1a; color: #ff9999; }
.status-bet { background: #1a551a; color: #99ff99; }
.neighbor-hint {
    font-size: 0.7rem;
    color: #aaa;
    margin-top: 2px;
}
</style>
</head>
<body>
<h1>
    <span>Precision Architect V3</span>
    <span id="algo-status" class="status-pill status-wait">READY</span>
</h1>

<div class="panel">
    <div class="label">Input History</div>
    <div id="buttons-container" class="grid"></div>
    <div class="controls">
        <button id="undo-btn" class="ctrl">Undo</button>
        <button id="clear-btn" class="ctrl">Reset All</button>
        <label style="font-size:0.8rem; color:#888;">
            Deep Memory: <input type="number" id="max-history" min="10" value="200" />
        </label>
    </div>
    <div class="history">
        <span id="history-display" style="letter-spacing: 1px;">(waiting for data...)</span>
    </div>
</div>

<div class="panel">
    <div class="balance-section">
        <div>
            <label for="balance-input" style="color: #bbb; font-size: 0.8rem;">Bankroll</label>
            <input type="number" id="balance-input" style="width:80px" value="1000" step="1" />
        </div>
        <div style="text-align:right;">
            <div style="font-size:0.8rem; color:#888;">System Confidence</div>
            <div id="confidence-text" style="font-size:1.1rem; font-weight:bold;">0%</div>
        </div>
    </div>
    <div class="confidence-meter"><div id="confidence-bar" class="confidence-fill"></div></div>
    <div class="label" style="margin-top:15px; display:flex; justify-content:space-between;">
        <span>Top 5 Probabilities</span>
        <span id="count-badge" class="badge">0 spins</span>
    </div>
    <ul id="predictions" class="predictions"></ul>
</div>

<div class="panel">
    <div class="label">Analysis Telemetry</div>
    <div class="stats-grid">
        <div class="stat-box">Momentum<span id="stat-hot" class="stat-val">-</span></div>
        <div class="stat-box">Hot Sector<span id="stat-sector" class="stat-val">-</span></div>
        <div class="stat-box">Active Window<span id="stat-cycle" class="stat-val">-</span></div>
        <div class="stat-box">Signal Strength<span id="stat-entropy" class="stat-val">-</span></div>
    </div>
</div>

<script>
// --- CONSTANTS ---
const ALL = Array.from({ length: 37 }, (_, i) => i);
const REDS = [1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36];
const WHEEL = [0, 32, 15, 19, 4, 21, 2, 25, 17, 34, 6, 27, 13, 36, 11, 30, 8, 23, 10, 5, 24, 16, 33, 1, 20, 14, 31, 9, 22, 18, 29, 7, 28, 12, 35, 3, 26];
const wheelIdx = {};
WHEEL.forEach((n, i) => wheelIdx[n] = i);

const SECTORS = { 
    "Voisins": [22,18,29,7,28,12,35,3,26,0,32,15,19,4,21,2,25], 
    "Tiers": [27,13,36,11,30,8,23,10,5,24,16,33], 
    "Orphelins": [1,20,14,31,9,17,34,6] 
};

// --- STATE & STORAGE ---
let history = [];
let lastTopPick = null;

const buttonsContainer = document.getElementById("buttons-container");
const historyDisplay = document.getElementById("history-display");
const predictionsList = document.getElementById("predictions");
const countBadge = document.getElementById("count-badge");
const balanceInput = document.getElementById("balance-input");
const algoStatus = document.getElementById("algo-status");
const confidenceBar = document.getElementById("confidence-bar");
const confidenceText = document.getElementById("confidence-text");
const statHot = document.getElementById("stat-hot");
const statSector = document.getElementById("stat-sector");
const statCycle = document.getElementById("stat-cycle");
const statEntropy = document.getElementById("stat-entropy");

// --- INITIALIZATION ---
function saveToLocal() {
    localStorage.setItem('roulette_v3_history', JSON.stringify(history));
    localStorage.setItem('roulette_v3_balance', balanceInput.value);
}

function loadFromLocal() {
    const h = localStorage.getItem('roulette_v3_history');
    const b = localStorage.getItem('roulette_v3_balance');
    if (h) history = JSON.parse(h);
    if (b) balanceInput.value = b;
}

function createButtons() {
    buttonsContainer.innerHTML = "";
    for (let n = 0; n <= 36; n++) {
        const btn = document.createElement("button");
        btn.textContent = n;
        btn.className = "num" + (n === 0 ? " zero" : REDS.includes(n) ? " red" : "");
        btn.onclick = () => addNumber(n);
        buttonsContainer.appendChild(btn);
    }
}

function addNumber(n) {
    const max = parseInt(document.getElementById("max-history").value) || 200;
    history.push(n);
    if (history.length > max) history.shift();
    saveToLocal();
    updateView();
}

document.getElementById("undo-btn").onclick = () => { history.pop(); saveToLocal(); updateView(); };
document.getElementById("clear-btn").onclick = () => { 
    if(confirm("Wipe history and reset balance?")) { 
        history = []; 
        lastTopPick = null; 
        saveToLocal(); 
        updateView(); 
    } 
};
balanceInput.onchange = saveToLocal;

// --- MATH ENGINE ---
function getNeighbors(num, count=1) {
    const idx = wheelIdx[num];
    const res = [];
    for(let i=1; i<=count; i++) {
        res.push(WHEEL[(idx + i) % 37], WHEEL[(idx - i + 37) % 37]);
    }
    return res;
}

function analyze(hist) {
    if(hist.length === 0) return null;
    const windowSize = Math.min(hist.length, 30);
    const window = hist.slice(-windowSize);
    const scores = new Array(37).fill(0);

    // 1. Recency Weighted Frequency
    window.forEach((n, i) => {
        scores[n] += (1 + (i / windowSize)) * 3;
    });

    // 2. Vector Momentum (Wheel Angle)
    let vx = 0, vy = 0;
    window.forEach((n, i) => {
        const weight = Math.pow(1.12, i);
        const rad = (wheelIdx[n]/37) * 2 * Math.PI;
        vx += Math.cos(rad) * weight;
        vy += Math.sin(rad) * weight;
    });
    const biasAngle = Math.atan2(vy, vx);

    ALL.forEach(n => {
        const rad = (wheelIdx[n]/37) * 2 * Math.PI;
        const diff = Math.abs(rad - biasAngle);
        const dist = Math.min(diff, 2*Math.PI - diff);
        // Add score for being in the "hot sector"
        if (dist < 1.3) scores[n] += (1.3 - dist) * 12;
        
        // Anti-Stall: If pick didn't hit, lower its weight for next spin
        if (lastTopPick === n && hist[hist.length-1] !== n && !getNeighbors(n,1).includes(hist[hist.length-1])) {
            scores[n] *= 0.55;
        }
        // Subtle Tie-breaker
        scores[n] += Math.random() * 0.1;
    });

    const finalRanked = ALL.map(n => ({ n, s: scores[n] })).sort((a,b) => b.s - a.s);
    
    // Confidence Logic: How much higher is the Top 1 vs the Average?
    const topScore = finalRanked[0].s;
    const avgScore = finalRanked.reduce((a,b) => a + b.s, 0) / 37;
    const strengthRatio = topScore / (avgScore || 1);
    
    // Scale confidence between 10% and 98%
    let confidence = Math.min(98, Math.max(10, (strengthRatio - 1.5) * 45));
    if (hist.length < 5) confidence = Math.max(10, hist.length * 5); // Start low

    return { ranked: finalRanked, confidence, strengthRatio, windowSize };
}

// --- UI UPDATE ---
function updateView() {
    countBadge.textContent = `${history.length} spins`;
    if(history.length === 0) {
        historyDisplay.innerHTML = "(ready for input)";
        predictionsList.innerHTML = "";
        confidenceText.textContent = "0%";
        confidenceBar.style.width = "0%";
        return;
    }

    historyDisplay.innerHTML = history.slice().reverse().slice(0, 15).map(n => 
        `<span class="${n===0?'green-txt':REDS.includes(n)?'red-txt':'black-txt'}">${n}</span>`
    ).join(" ");

    const data = analyze(history);
    lastTopPick = data.ranked[0].n;

    // Confidence Display
    const conf = data.confidence;
    confidenceBar.style.width = `${conf}%`;
    confidenceBar.style.backgroundColor = conf > 45 ? '#4caf50' : (conf > 25 ? '#e0aa00' : '#d32f2f');
    confidenceText.textContent = `${Math.round(conf)}%`;
    
    algoStatus.className = "status-pill " + (conf > 45 ? "status-bet" : "status-wait");
    algoStatus.textContent = conf > 45 ? "STRIKE ZONE" : "OBSERVING";

    // Telemetry
    statCycle.textContent = data.windowSize;
    statEntropy.textContent = data.strengthRatio.toFixed(2) + "x";
    statHot.textContent = data.ranked[0].n;
    
    let sec = "-";
    for(let k in SECTORS) if(SECTORS[k].includes(data.ranked[0].n)) sec = k;
    statSector.textContent = sec;

    // Predictions (Top 5 Always showing)
    predictionsList.innerHTML = "";
    const balance = parseFloat(balanceInput.value);
    const baseUnit = balance * 0.01;

    data.ranked.slice(0, 5).forEach((item, i) => {
        const neighbors = getNeighbors(item.n, 1);
        const li = document.createElement("li");
        if(i === 0) li.className = "top-pick";
        
        const scoreNorm = (item.s / data.ranked[0].s) * 100;
        // Bet amount depends on confidence and match percentage
        const bet = (baseUnit * (scoreNorm/100) * (conf/50)).toFixed(1);

        li.innerHTML = `
            <div style="display:flex; flex-direction:column; align-items:center;">
                <div class="pred-num ${item.n===0?'green-txt':REDS.includes(item.n)?'red-txt':'black-txt'}">${item.n}</div>
                <div class="neighbor-hint">Cover: ${neighbors.join(", ")}</div>
            </div>
            <div class="pred-stats">Relative: ${scoreNorm.toFixed(0)}%</div>
            <div class="pred-bet">Bet: ${bet}</div>
        `;
        predictionsList.appendChild(li);
    });
}

createButtons();
loadFromLocal();
updateView();
</script>
</body>
</html>